"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var n=require("react"),t=e(n),r=e(require("fbjs/lib/invariant")),o=require("phaser"),a=e(require("react-reconciler")),c=e(require("performance-now")),i=e(require("uuid/v4")),s=n.createContext(null);function u(){return n.useContext(s)}var f=n.createContext(null);function l(){return n.useContext(f)}function d(e,n){return e.children.list.filter((function(e){return e.name===n}))}function p(e,t,r){var o=r.onCollide,a=r.onProcess,c=r.overlapOnly,i=u(),s=n.useRef(null);n.useLayoutEffect((function(){return s.current=i.physics.add.collider(y(i,e),y(i,t),o,a),s.current.overlapOnly=c,function(){s.current.destroy()}}),[]),n.useLayoutEffect((function(){s.current&&(s.current.object1=y(i,e),s.current.object2=y(i,t))}),[e,t]),n.useLayoutEffect((function(){s.current&&(s.current.collideCallback=o,s.current.processCallback=a,s.current.overlapOnly=c)}),[o,a,c])}function y(e,n){return(t=n,Array.isArray(t)?t:[t]).reduce((function(n,t){return[].concat(n,"string"==typeof t?d(e,t):[t])}),[]);var t}var m=n.createContext(null);function h(){return(h=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}function v(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n.indexOf(t=a[r])>=0||(o[t]=e[t]);return o}var b={children:!0,parent:!0,object:!0,physics:!0,physicsType:!0,instance:!0,scene:!0};function x(e,n,t){var r;Object.keys((r=t,Object.keys(r).reduce((function(e,n){var t;return-1===Object.keys(b).indexOf(n)?h({},e,((t={})[n]=r[n],t)):h({},e)}),{}))).forEach((function(r){var o,a,c;if(void 0!==t[r]&&n[r]!==t[r]){var i=t[r];switch(r){case"data":Object.keys(t.data).forEach((function(n){e.setData(n,t.data[n])}));break;case"acceleration":case"bounce":case"drag":case"friction":case"gravity":case"velocity":case"maxVelocity":var s=C(n[r]),u=C(t[r]);((a=s).x!==(c=u).x||a.y!==c.y)&&g(e,r,u.x,u.y);break;case"accumulator":case"delay":case"duration":case"forward":case"frameRate":case"isPlaying":case"msPerFrame":case"skipMissedFrames":case"progress":case"stopOnFrame":case"stopAfterDelay":case"repeat":case"repeatDelay":case"timeScale":case"yoyo":g(e.anims,r,i);break;case"debug":n.debugShowBody===t.debugShowBody&&n.debugShowVelocity===t.debugShowVelocity&&n.debugBodyColor===t.debugBodyColor||e.setDebug(t.debugShowBody,t.debugShowVelocity,t.debugBodyColor);break;case"disableBody":case"hideBody":n.disableBody===t.disableBody&&n.hideBody===t.hideBody||e.disableBody(t.disableBody,t.hideBody);break;case"circle":t.circle&&(n.circle&&n.circle.radius===t.circle.radius&&n.circle.offsetX===t.circle.offsetX&&n.circle.offsetY===t.circle.offsetY||e.setCircle(t.circle.radius,t.circle.offsetX,t.circle.offsetY));break;case"offset":n.offset&&n.offset.x===t.offset.x&&n.offset.y===t.offset.y||e.setOffset(t.offset.x,t.offset.y);break;case"onWorldBounds":g(e.body,r,i);break;case"size":t.size&&(n.size&&n.size.width===t.size.width&&n.size.height===t.size.height&&n.size.center===t.size.center||e.setSize(t.size.width,t.size.height,t.size.center));break;case"allowGravity":case"allowDrag":case"allowAcceleration":g(e.body,r,i);break;case"scale":"number"==typeof i?e.setScale(i):e.setScale(i.x,i.y,i.point?[i.point.x,i.point.y]:void 0),1===(null===(o=e.body)||void 0===o?void 0:o.physicsType)&&e.body.updateFromGameObject();break;default:g(e,r,t[r])}}}))}function g(e,n){for(var t="set"+(n.slice(0,1).toUpperCase()+n.slice(1)),r=arguments.length,o=new Array(r>2?r-2:0),a=2;a<r;a++)o[a-2]=arguments[a];e[t]?e[t].apply(e,o):"function"==typeof e[n]?e[n].apply(e,o):e[n]=o[0]}function C(e){return"number"==typeof e?{x:e,y:e}:e||{x:0,y:0}}var w={GameObject:{create:function(e){var n=e.instance,t=e.scene,r=e.physics,o=e.physicsType;return n.__reactPhaser={sceneKey:t.scene.key},"arcade"===r&&t&&t.physics.world.enable(n,"static"===o?Phaser.Physics.Arcade.STATIC_BODY:Phaser.Physics.Arcade.DYNAMIC_BODY),n},applyProps:function(e,n,t){x(e,n,t)}}},E=t.createContext(null);function O(e,r){var o=e.children,a=v(e,["children"]),c=u(),i=n.useMemo((function(){return c.add.group([])}),[]);return n.useLayoutEffect((function(){return function(){i.destroy()}}),[]),n.useImperativeHandle(r,(function(){return i})),n.useLayoutEffect((function(){i.active=a.active,i.defaultFrame=a.defaultFrame,i.defaultKey=a.defaultKey,i.isParent=a.isParent,i.name=a.name}),[a]),t.createElement(E.Provider,{value:i},o)}var P=t.forwardRef(O);function j(){return n.useContext(E)}var S=t.createContext(null);function I(e){var r=u(),o=j();return n.useLayoutEffect((function(){if(o)return o.add(e.instance),function(){o.remove(e.instance)}}),[o]),t.createElement(S.Provider,{value:e.instance},t.createElement("GameObject",Object.assign({scene:r},e)),e.children)}function k(){return n.useContext(S)}function A(e,r){var a=u(),c=n.useMemo((function(){return e.instance||new o.Physics.Arcade.Image(a,e.x,e.y,e.texture,e.frame)}),[]);return n.useImperativeHandle(r,(function(){return c})),t.createElement(I,Object.assign({instance:c,physics:"arcade"},e))}var G=t.forwardRef(A);function T(e,r){var a=e.animations,c=e.animation,i=v(e,["animations","animation"]),s=u(),f=n.useMemo((function(){return i.instance||new o.GameObjects.Sprite(s,i.x,i.y,i.texture,i.frame)}),[]);return n.useImperativeHandle(r,(function(){return f})),n.useLayoutEffect((function(){return a&&a.forEach((function(e){s.anims.create(e)})),function(){a&&a.forEach((function(e){s.anims.remove(e.key)}))}}),[a]),n.useLayoutEffect((function(){c&&f.play(c,!0)}),[c]),t.createElement(I,Object.assign({instance:f},i))}var B=t.forwardRef(T);function D(e,r){var a=u(),c=n.useMemo((function(){return e.instance||new o.Physics.Arcade.Sprite(a,e.x,e.y,e.texture,e.frame)}),[]);return n.useImperativeHandle(r,(function(){return c})),t.createElement(B,Object.assign({instance:c,physics:"arcade"},e))}var _=t.forwardRef(D);function z(e,n){if(e instanceof Phaser.Game&&n.__reactPhaser.sceneKey){var t=e.scene.getScene(n.__reactPhaser.sceneKey);t.children.exists(n)||t.add.existing(n)}Phaser}function H(e,n){n.destroy&&n.destroy()}function L(e,n,t){if(n===t&&r(!1),e instanceof Phaser.Game){var o=e.scene.getScene(n.__reactPhaser.sceneKey),a=o.children.exists(n),c=o.children.getIndex(t);a?o.children.moveTo(n,c):o.children.addAt(n,c)}}var M=a({getRootHostContext:function(e){return e},getChildHostContext:function(){return{}},getChildHostContextForEventComponent:function(e){return e},getPublicInstance:function(e){return e},prepareForCommit:function(){},resetAfterCommit:function(){},createInstance:function(e,n,t){void 0===n&&(n={});var r=w[e],o=r.applyProps,a=void 0===o?x:o,c=(0,r.create)(n,t);return c.applyProps=a.bind(c),a(c,{},n),c},hideInstance:function(e){e.setActive&&e.setActive(!1)},unhideInstance:function(e,n){var t=null==n||!n.hasOwnProperty("active")||n.active;e.setActive(t)},appendInitialChild:z,finalizeInitialChildren:function(e,n,t){return!1},prepareUpdate:function(e,n,t,r,o,a){return function(e,n,t,r,o){var a=null;for(var c in t)!r.hasOwnProperty(c)&&t.hasOwnProperty(c)&&null!=t[c]&&("children"===c||(a||(a=[]),a.push(c,null)));for(var i in r){var s=r[i],u=null!=t?t[i]:void 0;!r.hasOwnProperty(i)||s===u||null==s&&null==u||"children"===i||(a||(a=[]),a.push(i,s))}return a}(0,0,t,r)},shouldSetTextContent:function(e,n){return!1},shouldDeprioritizeSubtree:function(e,n){return!(void 0===n.active||!0===n.active)},createTextInstance:function(e,n,t){r(!1)},mountEventComponent:function(){},updateEventComponent:function(){},handleEventTarget:function(){},scheduleTimeout:setTimeout,cancelTimeout:clearTimeout,noTimeout:-1,warnsIfNotActing:!1,now:c,isPrimaryRenderer:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,appendChild:z,appendChildToContainer:z,removeChild:H,removeChildFromContainer:H,insertBefore:L,insertInContainerBefore:L,commitUpdate:function(e,n,t,r,o){var a=e&&e.applyProps;"function"!=typeof a&&(a=x),a(e,r,o)},commitMount:function(e,n,t,r,o){},commitTextUpdate:function(e,n,t){},resetTextContent:function(e){}}),N=function(e){var n,r;function a(){var n;return(n=e.apply(this,arguments)||this).state={booting:!0},n}r=e,(n=a).prototype=Object.create(r.prototype),n.prototype.constructor=n,n.__proto__=r;var c=a.prototype;return c.componentDidMount=function(){var e=this,n=v(this.props,["children","canvas"]);this.game=new o.Game(h({},n)),this.game.events.on("ready",(function(){e.setState({booting:!1})})),this.mountNode=M.createContainer(this.game,!1,!1),M.injectIntoDevTools({bundleType:0,version:"0.2.4",rendererPackageName:"react-phaser-fiber",findFiberByHostInstance:M.findHostInstance}),M.updateContainer(this.getChildren(),this.mountNode,this,null)},c.componentDidUpdate=function(){M.updateContainer(this.getChildren(),this.mountNode,this,null)},c.getChildren=function(){return t.createElement(f.Provider,{value:this.game},this.state.booting?null:this.props.children)},c.componentDidCatch=function(e,n){console.error("Error occurred in `Game`."),console.error(e),console.error(n)},c.componentWillUnmount=function(){M.updateContainer(null,this.mountNode,this,null),this.game.destroy(!0)},c.render=function(){return null},a}(t.Component);function R(e,r){var a=u(),c=n.useMemo((function(){return e.instance||new o.GameObjects.Image(a,e.x,e.y,e.texture,e.frame)}),[]);return n.useImperativeHandle(r,(function(){return c})),t.createElement(I,Object.assign({instance:c},e))}N.displayName="Game";var F=t.forwardRef(R);function K(e,r){var a=e.sceneKey,c=e.children,i=e.renderLoading,u=e.onPreload,f=e.onCreate,d=e.onInit,p=v(e,["sceneKey","children","renderLoading","onPreload","onCreate","onInit"]),y=l(),m=n.useState(!!u),b=m[0],x=m[1],g=n.useState(0),C=g[0],w=g[1],E=n.useMemo((function(){var e=new o.Scene(h({},p,{key:a}));return e.preload=u?function(){u(e),e.load.once("complete",(function(){x(!1),w(0)})),e.load.start()}:null,e.create=f?function(){return f(e)}:null,e.init=d?function(){return d(e)}:null,y.scene.add(a,e,!0),e}),[]);return n.useImperativeHandle(r,(function(){return E})),n.useLayoutEffect((function(){var e=[];return e.push(E.load.once("start",(function(){x(!!u)})),E.load.on("progress",(function(e){w(e)}))),function(){y.scene.remove(a),e.forEach((function(e){e.eventNames().forEach((function(n){return e.off(n)}))}))}}),[]),t.createElement(s.Provider,{value:E},b&&i?i(C):c)}var Y=t.forwardRef(K);function q(e,n){switch(n.type){case"SPAWN":return h({},e,{children:[].concat(e.children,[n.payload])});case"DESTROY_CHILD":return h({},e,{children:e.children.filter((function(e){return e.key!==n.payload}))})}return e}function U(e,r){var a=u(),c=n.useMemo((function(){return e.instance||new o.GameObjects.Text(a,e.x,e.y,e.text,e.style)}),[]);return n.useImperativeHandle(r,(function(){return c})),t.createElement(I,Object.assign({instance:c},e))}var W=t.forwardRef(U);exports.ArcadeCollider=function(e){var n=e.onCollide,t=e.onProcess,r=e.overlapOnly,o=k();if(!o)throw Error("ArcadeCollider must be used within a GameObject component");return p(o,e.with,{overlapOnly:r,onCollide:n,onProcess:t}),null},exports.ArcadeImage=G,exports.ArcadeSprite=_,exports.Game=N,exports.GameObject=I,exports.GameObjectContext=S,exports.Group=P,exports.Image=F,exports.Scene=Y,exports.Spawner=function(e){var r=e.children,o=n.useReducer(q,{children:[]}),a=o[0],c=o[1],s=n.useMemo((function(){return{spawn:function(e,n){var t=i();return c({type:"SPAWN",payload:{component:e,props:n,key:t}}),t}}}),[a]);return t.createElement(m.Provider,{value:s},a.children.map((function(e){return t.createElement(e.component,Object.assign({key:e.key},e.props,{onDestroy:function(){e.props.onDestroy&&e.props.onDestroy(),c({type:"DESTROY_CHILD",payload:e.key})}}))})),r)},exports.SpawnerContext=m,exports.Sprite=B,exports.Text=W,exports.findGameObjectsByName=d,exports.useArcadeCollider=p,exports.useGame=l,exports.useGameEvent=function(e,t){var r=l();n.useEffect((function(){return r.events.on(e,t),function(){r.events.off(e,t)}}),[t])},exports.useGameLoop=function(e){var t=l();n.useEffect((function(){var n=function(n,t){e({delta:t,time:n})};return t.events.on("step",n),function(){t.events.off("step",n)}}),[e])},exports.useGameObject=k,exports.useGamepadEvent=function(e,t){var o=u();n.useEffect((function(){return o||r(!1),o.input.gamepad.on(e,t),function(){o.input.gamepad.off(e,t)}}),[o,e,t])},exports.useGroup=j,exports.useInputEvent=function(e,t){var o=u();n.useEffect((function(){return o||r(!1),o.input.on(e,t),function(){o.input.off(e,t)}}),[o,e,t])},exports.useKeyboardEvent=function(e,t){var o=u();n.useEffect((function(){return o||r(!1),o.input.keyboard.on(e,t),function(){o.input.keyboard.off(e,t)}}),[o,e,t])},exports.useScene=u,exports.useSpawner=function(){return n.useContext(m)},exports.withSpawner=function(e){function t(t){return n.createElement(m.Consumer,null,(function(r){return n.createElement(e,Object.assign({},t,{spawner:r}))}))}return t.displayName="WithSpawner("+e.displayName+")",t};
//# sourceMappingURL=react-phaser-fiber.cjs.production.min.js.map
